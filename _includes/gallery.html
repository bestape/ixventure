{%- comment -%}
Gallery include
----------------------------------
Usage:
  {% include gallery.html slug="project-a" title="Project A" %}
If omitted, it will use page.slug or page.name as a fallback.
{%- endcomment -%}

{%- assign project_slug = include.slug | default: page.slug | default: page.name | split: "." | first -%}
{%- assign project_path = '/assets/projects/' | append: project_slug -%}

<div class="gallery">
  <div class="swiper gallery-swiper">
    <div class="swiper-wrapper">
      {%- assign extensions = "png,jpg,jpeg,svg" | split: "," -%}
      {%- assign screenshots = site.static_files | where_exp: "file", "file.path contains project_path" -%}

      {%- assign numbered_files = "" | split: "" -%}

      {%- for file in screenshots -%}
        {%- assign ext = file.extname | remove: "." | downcase -%}
        {%- assign name_no_ext = file.name | remove: file.extname | remove: "." -%}
        {%- assign parts = name_no_ext | split: "-" -%}
        {%- assign last_part = parts | last -%}
        {%- assign number_val = last_part | plus: 0 -%}

        {%- if extensions contains ext and number_val > 0 -%}
          {%- assign item = file.path | append: "|" | append: number_val | append: "|" | append: ext -%}
          {%- assign numbered_files = numbered_files | push: item -%}
        {%- endif -%}
      {%- endfor -%}

      {%- assign sorted_files = numbered_files | sort_natural -%}

      {%- for item in sorted_files -%}
        {%- assign parts = item | split: "|" -%}
        <div class="swiper-slide">
          <img src="{{ parts[0] | relative_url }}?v={{ site.time | date: '%s' }}"
               alt="{{ include.title | default: page.title }} screenshot">
        </div>
      {%- endfor -%}
    </div>

    <div class="swiper-pagination"></div>
  </div>
</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const wrapperSelector = ".gallery-swiper";
  const wrapper = document.querySelector(wrapperSelector);
  if (!wrapper) return;

  if (wrapper.querySelectorAll(".swiper-slide").length === 0) {
    const msg = document.createElement("p");
    msg.innerHTML =
      `<em>No gallery images found. Please add files matching <code>-NUMBER.png|.jpg|.jpeg|.svg</code> to <code>{{ project_path }}</code>.</em>`;
    wrapper.parentNode.insertBefore(msg, wrapper);
    wrapper.remove();
    return;
  }

  new Swiper(wrapperSelector, {
    loop: true,
    pagination: { el: wrapperSelector + ' .swiper-pagination', clickable: true },
    slidesPerView: 1,
    spaceBetween: 10
  });
});
</script>
