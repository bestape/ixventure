<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const wrapperSelector = ".gallery-swiper";
  const wrapper = document.querySelector(wrapperSelector);
  if (!wrapper) return;

  if (wrapper.querySelectorAll(".swiper-slide").length === 0) {
    const msg = document.createElement("p");
    msg.innerHTML =
      `<em>No gallery images found. Please add files matching <code>-NUMBER.png|.jpg|.jpeg|.svg</code> to the gallery folder.</em>`;
    wrapper.parentNode.insertBefore(msg, wrapper);
    wrapper.remove();
    return;
  }

  // Initialize Swiper
  const swiper = new Swiper(wrapperSelector, {
    loop: true,
    pagination: { el: wrapperSelector + ' .swiper-pagination', clickable: true },
    slidesPerView: 1,
    spaceBetween: 10,
    keyboard: { enabled: true, onlyInViewport: true }
  });

  // Single click vs double click detection
  let clickTimer = null;

  wrapper.addEventListener("click", function (e) {
    if (e.target.tagName.toLowerCase() !== "img") return;

    if (clickTimer !== null) {
      // Double-click detected
      clearTimeout(clickTimer);
      clickTimer = null;

      // Toggle browser fullscreen
      if (!document.fullscreenElement) {
        wrapper.requestFullscreen?.();
      } else {
        document.exitFullscreen?.();
      }
      return;
    }

    // Single click: slide prev/next
    clickTimer = setTimeout(() => {
      const rect = e.target.getBoundingClientRect();
      const clickX = e.clientX - rect.left;
      if (clickX < rect.width / 2) {
        swiper.slidePrev();
      } else {
        swiper.slideNext();
      }
      clickTimer = null;
    }, 250); // 250ms delay to detect double-click
  });

  // Escape key exits fullscreen
  document.addEventListener("keydown", function (e) {
    if (e.key === "Escape" && document.fullscreenElement) {
      document.exitFullscreen();
    }
  });
});
</script>
